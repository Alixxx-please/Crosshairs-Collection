name: Prepare and Upload Final Zip

on:
  workflow_dispatch: # Permet de déclencher le workflow manuellement

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up zip utility
      run: sudo apt-get install -y zip unzip

    - name: Zip each texture pack
      run: |
        cd $GITHUB_WORKSPACE
        # Parcourir chaque dossier de catégorie à la racine
        for category in */; do
          cd "$category"
          # Parcourir chaque sous-dossier (qui est un pack de textures)
          for texture_pack in */; do
            cd "$texture_pack"
            # Zipper le contenu du pack de textures directement
            zip -r "../${texture_pack%/}.zip" ./*
            cd ..
            # Supprimer le dossier du pack de textures après zippage
            rm -rf "$texture_pack"
          done
          cd ..
        done

    - name: Create Crosshairs Collection folder and move categories
      run: |
        cd $GITHUB_WORKSPACE
        # Créer un dossier Crosshairs Collection
        mkdir "Crosshairs Collection"
        # Déplacer uniquement les dossiers de catégories dans le dossier Crosshairs Collection
        for category in */; do
          if [ "$category" != "Crosshairs Collection/" ] && [ "$category" != ".git/" ] && [ "$category" != ".github/" ]; then
            mv "$category" "Crosshairs Collection/"
          fi
        done

    - name: Zip the entire structure with the Crosshairs Collection folder
      run: |
        cd $GITHUB_WORKSPACE
        # Créer le fichier zip final avec le dossier Crosshairs Collection
        zip -r "Crosshairs Collection.zip" "Crosshairs Collection"
        # Supprimer le dossier temporaire
        rm -rf "Crosshairs Collection"

    - name: Upload the final zip as an artifact
      uses: actions/upload-artifact@v4
      with:
        name: Crosshairs Collection
        path: "Crosshairs Collection.zip"
        if-no-files-found: error
